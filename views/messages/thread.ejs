<div class="thread-container">
  <a href="/messages/inbox" class="back-link">‚Üê Back to Inbox</a>

  <div class="chat-thread">
    <!-- Chat Header -->
    <div class="chat-header">
      <h2><%= headerName %></h2>
    </div>

    <!-- Messages -->
    <div class="chat-messages">
      <% const allMessages = [originalMessage, ...replies].sort((a,b) => new Date(a.createdAt) - new Date(b.createdAt)); %>
      <% allMessages.forEach((msg, index) => { %>
        <div class="chat-message <%= msg.fromUserId?.toString() === user.id ? 'sent' : 'received' %>">
          <div class="message-bubble">
            <p><%= msg.text %></p>
            <small class="message-time">
              <%= new Date(msg.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
            </small>
          </div>
        </div>
      <% }) %>
    </div>

    <!-- Reply Form -->
    <% if (originalMessage.fromUserId) { %>
      <div class="reply-form">
        <form action="/messages/reply" method="post">
          <input type="hidden" name="toUserId" value="<%= originalMessage.fromUserId %>">
          <input type="hidden" name="replyTo" value="<%= originalMessage._id %>">
          <textarea name="text" placeholder="Type your reply..." required></textarea>
          <button type="submit">Send</button>
        </form>
      </div>
    <% } %>
  </div>
</div>